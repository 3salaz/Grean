import{u as S,n as V,o as f,q as e,I as O,Q as se,t as B,v as b,x as h,y as q,z as Y,A as K,B as M,C as D,D as g,E as v,F as N,G as C,H as R,J as E,L as te,M as ne,N as _,O as G,P,R as k,S as U,T as ae,U as le,V as oe,W as ie,X as re,Y as I,Z as ce,_ as de,$ as A,a0 as ue,a1 as he,a2 as xe,a3 as me,a4 as Z,a5 as fe}from"./index-Cbk5-mWy.js";import{b as ge}from"./business-C2eozn8Z.js";const je="/assets/home-z6Lq8Zb-.png";var pe={};const J=({handleClose:t})=>{const{profile:l,updateProfileField:r}=S(),{createLocation:x}=V(),[o,i]=f.useState(0),[c,d]=f.useState(!1),[j,m]=f.useState(!1),[s,n]=f.useState({locationType:"",homeName:"",street:"",city:"",state:"California",businessName:"",businessPhoneNumber:"",category:""}),u=(a,p)=>{n(y=>({...y,[a]:p}))},w=()=>{switch(o){case 0:return s.locationType;case 1:return s.street&&s.city&&s.state;case 2:return s.locationType==="Business"?s.businessName&&s.businessPhoneNumber&&s.category:s.homeName;default:return!1}},L=pe.VITE_GOOGLE_MAPS_API_KEY,$=async a=>{try{console.log("Fetching coordinates for address:",a);const y=await(await fetch(`https://maps.googleapis.com/maps/api/geocode/json?address=${encodeURIComponent(a)}&key=${L}`)).json();if(console.log("Google Maps API Response:",y),y.status==="OK"&&y.results.length>0){const{lat:T,lng:H}=y.results[0].geometry.location;return console.log("Extracted Coordinates:",{latitude:T,longitude:H}),{latitude:T,longitude:H}}else throw new Error(`Geocoding API Error: ${y.status} - ${y.error_message||"No results found"}`)}catch(p){return console.error("Error fetching coordinates:",p),null}};(async()=>{const p=await $("1600 Amphitheatre Parkway, Mountain View, CA");console.log("Test Result:",p)})();const Q=async()=>{if(!w()){k.error("Please fill in all required fields before proceeding.");return}if(o===1){m(!0);const a=`${s.street}, ${s.city}, ${s.state}`;try{const{latitude:p,longitude:y}=await $(a);n(T=>({...T,latitude:p,longitude:y}))}catch(p){console.error("Error fetching coordinates:",p.message)}finally{m(!1)}}i(a=>a+1)},W=()=>i(a=>a-1),X=async()=>{if(!w()){console.log("Please fill in all required fields.");return}d(!0);try{const a={locationType:s.locationType||"Unknown",street:s.street||"",city:s.city||"",state:s.state||"California",latitude:s.latitude||null,longitude:s.longitude||null,...s.locationType==="Home"&&{homeName:s.homeName||"Home"},...s.locationType==="Business"&&{businessName:s.businessName||"",businessPhoneNumber:s.businessPhoneNumber||"",category:s.category||"Other"}},p=await x(a);console.log(l.uid);const y={...a,id:p};await r(l.uid,"locations",y,"addToArray"),console.log("Location added successfully!"),t()}catch(a){console.error("Error adding location:",a.message)}finally{d(!1)}},ee=()=>{switch(o){case 0:return e.jsx(h,{size:"12",children:e.jsxs(ne,{value:s.locationType,className:"w-full flex justify-center gap-2",onIonChange:a=>u("locationType",a.detail.value),children:[e.jsxs(_,{value:"Business",labelPlacement:"start",children:[e.jsx(G,{className:`transition-all duration-300 ${s.locationType==="Business"?"w-40 h-40":"w-20 h-20"}`,src:ge,alt:"Business"}),e.jsx(P,{className:"text-center",color:"primary",children:e.jsx("h4",{children:"Business"})})]}),e.jsxs(_,{value:"Home",labelPlacement:"end",children:[e.jsx(G,{className:`transition-all duration-300 ${s.locationType==="Home"?"w-40 h-40":"w-20 h-20"}`,src:je,alt:"Home"}),e.jsx(P,{className:"text-center",color:"primary",children:e.jsx("h4",{children:"Home"})})]})]})});case 1:return e.jsxs(te,{className:"w-full p-0 m-0",children:[e.jsxs(v,{className:"w-full",children:[e.jsx(N,{position:"stacked",children:"Street"}),e.jsx(C,{value:s.street,onIonChange:a=>u("street",a.detail.value),placeholder:"Enter street address"})]}),e.jsxs(v,{children:[e.jsx(N,{position:"stacked",children:"City"}),e.jsxs(R,{value:s.city,onIonChange:a=>u("city",a.detail.value),placeholder:"Select a city",children:[e.jsx(E,{value:"San Francisco",children:"San Francisco"}),e.jsx(E,{value:"Daly City",children:"Daly City"})]})]})]});case 2:return s.locationType==="Home"?e.jsxs(v,{children:[e.jsx(N,{position:"stacked",children:"Home Name"}),e.jsx(C,{value:s.homeName,onIonChange:a=>u("homeName",a.detail.value),placeholder:"Enter home name"})]}):e.jsxs(e.Fragment,{children:[e.jsxs(v,{children:[e.jsx(N,{position:"stacked",children:"Business Name"}),e.jsx(C,{value:s.businessName,onIonChange:a=>u("businessName",a.detail.value),placeholder:"Enter business name"})]}),e.jsxs(v,{children:[e.jsx(N,{position:"stacked",children:"Business Phone Number"}),e.jsx(C,{value:s.businessPhoneNumber,onIonChange:a=>u("businessPhoneNumber",a.detail.value),placeholder:"Enter business phone number"})]}),e.jsxs(v,{children:[e.jsx(N,{position:"stacked",children:"Category"}),e.jsx(R,{value:s.category,onIonChange:a=>u("category",a.detail.value),placeholder:"Select a Category",children:["Restaurant","Bar","Hotel","Grocery Store","Office","Event Venue","Other"].map(a=>e.jsx(E,{value:a,children:a},a))})]})]});default:return null}};return e.jsxs(O,{children:[e.jsx(se,{position:"top-center",autoClose:3e3,hideProgressBar:!1,newestOnTop:!1,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!0,theme:"colored"}),e.jsxs(B,{className:"h-full flex flex-col",children:[e.jsx(b,{className:"w-full flex-grow",children:e.jsx(h,{size:"12",className:"h-full",children:e.jsxs(q,{className:"w-full m-0 shadow-none h-full flex flex-col items-center justify-center",children:[e.jsx(Y,{children:e.jsx(K,{children:"Add Location"})}),e.jsxs(M,{className:"flex flex-col items-center justify-center p-2 w-full h-[300px]",children:[e.jsxs(D.div,{className:"w-full",initial:{opacity:0,y:50},animate:{opacity:1,y:0},exit:{opacity:0,x:-50},transition:{duration:.3},children:[e.jsx(b,{className:"w-full",children:ee()}),j]},o),c]})]})})}),e.jsxs(b,{className:"flex items-center justify-center ion-padding",children:[o===0&&e.jsx(h,{size:"4",children:e.jsx(g,{color:"danger",expand:"block",onClick:t,children:"Exit"})}),o>0&&e.jsx(h,{size:"4",children:e.jsx(g,{expand:"block",onClick:W,children:"Back"})}),o<2&&e.jsx(h,{size:"4",children:e.jsx(g,{expand:"block",onClick:Q,children:"Next"})}),o===2&&e.jsx(h,{size:"4",children:e.jsx(g,{expand:"block",onClick:X,children:"Submit"})})]})]})]})},ye=({onClose:t})=>{const{profile:l,updateProfile:r,deleteProfile:x}=S(),[o,i]=f.useState({displayName:"",email:"",profilePic:"",accountType:"User"});f.useEffect(()=>{l&&i({displayName:l.displayName||"",email:l.email||"",profilePic:l.profilePic||"",accountType:l.accountType||"User"})},[l]);const c=m=>{const{name:s,value:n}=m.target;i(u=>({...u,[s]:n}))},d=async()=>{try{await r("displayName",o.displayName),await r("email",o.email),await r("profilePic",o.profilePic),k.success("Profile updated successfully!"),t()}catch(m){console.error("❌ Error updating profile:",m),k.error("Failed to update profile.")}},j=async()=>{try{await x(),k.warn("Profile deleted!"),t()}catch(m){console.error("❌ Error deleting profile:",m),k.error("Failed to delete profile.")}};return l?e.jsxs(U,{children:[e.jsx(ae,{children:e.jsxs(le,{children:[e.jsx(oe,{children:"Edit Profile"}),e.jsx(ie,{slot:"end",children:e.jsx(g,{onClick:t,children:"Close"})})]})}),e.jsxs(O,{className:"ion-padding",children:[e.jsxs(v,{children:[e.jsx(N,{position:"fixed",children:"Name"}),e.jsx(C,{name:"displayName",value:o.displayName,onIonInput:c})]}),e.jsxs(v,{children:[e.jsx(N,{position:"fixed",children:"Email"}),e.jsx(C,{name:"email",type:"email",value:o.email,onIonInput:c})]}),e.jsxs(v,{children:[e.jsx(N,{position:"fixed",children:"Profile Picture URL"}),e.jsx(C,{name:"profilePic",type:"text",value:o.profilePic,onIonInput:c})]})]}),e.jsxs(re,{className:"ion-padding",children:[e.jsx(g,{expand:"block",color:"primary",onClick:d,children:"Save"}),e.jsx(g,{expand:"block",color:"danger",onClick:j,children:"Delete"}),e.jsx(g,{expand:"block",fill:"outline",onClick:t,children:"Cancel"})]})]}):e.jsx(U,{children:e.jsx(O,{className:"ion-padding flex items-center justify-center",children:e.jsx(N,{children:"Loading profile..."})})})},be=({openModal:t})=>{var o;const{profile:l}=S(),[r,x]=f.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs(b,{className:"ion-align-items-end ion-padding rounded-t-lg ion-justify-content-between bg-white",children:[e.jsx(h,{size:"9",className:"flex justify-start p-0 rounded-md bg-grean bg-opacity-60",children:e.jsxs("div",{className:"flex px-2 p-1 flex-col items-start justify-end rounded-lg",children:[e.jsx(P,{className:"text-xl font-bold",children:(l==null?void 0:l.displayName)||"User 1"}),e.jsxs(P,{className:"text-xs bg-green-50 font-bold rounded-lg",children:["Email: ",(l==null?void 0:l.email)||"No Email"]})]})}),e.jsx(h,{size:"3",className:"flex flex-col items-end justify-end",children:e.jsxs("div",{className:"flex text-xs items-center justify-center gap-1",children:[e.jsx(g,{onClick:()=>x(!0),size:"small",shape:"round",color:"danger",children:e.jsx(I,{slot:"icon-only",icon:ce})}),!((o=l==null?void 0:l.locations)!=null&&o.length)&&t&&e.jsx(g,{onClick:t,size:"small",shape:"round",color:"primary",children:e.jsx(I,{slot:"icon-only",icon:de})})]})})]}),e.jsx(A,{isOpen:r,onDidDismiss:()=>x(!1),children:e.jsx(ye,{profile:l,onClose:()=>x(!1)})})]})},Ne="/assets/forestbg-C_Iko2vb.webp",z="/assets/sprout-DGNcIT_s.png",we="/assets/glassTree-CMMLAINd.png",ve="/assets/aluminumTree-MO-Cb-wb.png",Ie="/assets/plasticTree-CFPftc7B.png",F="/assets/mediumTree-Bbd7rWy2.png",Ce={plastic:{stages:[{stage:"sprout",src:z,width:60,height:60},{stage:"young",src:F,width:60,height:100},{stage:"mature",src:Ie,width:120,height:200}]},aluminum:{stages:[{stage:"sprout",src:z,width:60,height:60},{stage:"young",src:F,width:60,height:100},{stage:"mature",src:ve,width:120,height:200}]},glass:{stages:[{stage:"sprout",src:z,width:60,height:60},{stage:"young",src:F,width:60,height:100},{stage:"mature",src:we,width:120,height:160}]}};function Pe({type:t,recycledWeight:l,thresholds:r,isSelected:x,onSelect:o}){const i=Ce[t].stages,c=r[t];let d=i[0];l>=2*c?d=i[2]:l>=c&&(d=i[1]);const j={hidden:{opacity:0,scale:0},visible:{opacity:1,scale:1},exit:{opacity:0,scale:.8}};return e.jsx(ue,{mode:"wait",children:e.jsx(D.div,{className:"tree-wrapper",style:{display:"flex",justifyContent:"center",alignItems:"flex-end",height:"150px"},initial:"hidden",animate:"visible",exit:"exit",variants:j,transition:{duration:.5},children:e.jsx("img",{src:d.src,alt:`${t} tree at ${d.stage} stage`,className:"object-cover",style:{width:d.width,height:d.height,border:x?"2px solid blue":"none",cursor:"pointer"},onClick:()=>o(t)})},d.stage)})}function ke(){const t={plastic:13,aluminum:5.7,glass:26.5},l={plastic:0,aluminum:0,glass:0},[r,x]=f.useState(l),[o,i]=f.useState(null);return e.jsxs("div",{style:{backgroundImage:`url(${Ne})`},className:"bg-cover bg-center w-full drop-shadow-lg rounded-b-xl",children:[e.jsx(b,{className:"mb-10 pl-2",children:e.jsx(h,{size:"auto",className:"bg-[#75B657] px-2 mx-auto text-center rounded-b-md px-4",children:e.jsx(P,{color:"secondary",className:"font-bold text-white text-xl",children:"Your Forest"})})}),e.jsx(b,{className:"flex justify-center space-x-4",children:Object.keys(r).map(c=>e.jsx(Pe,{type:c,recycledWeight:r[c],thresholds:t,isSelected:o===c,onSelect:i},c))})]})}function Te(){const[t,l]=f.useState(!1),[r,x]=f.useState(0),o=f.useRef([]),{locations:i}=V(),{profile:c}=S(),d=()=>{l(!0)},j=()=>{l(!1)},m=s=>{const n=o.current[s];n&&(n.scrollIntoView({behavior:"smooth",inline:"center"}),x(s))};return f.useEffect(()=>{const s=new IntersectionObserver(n=>{n.forEach(u=>{if(u.isIntersecting){const w=o.current.findIndex(L=>L===u.target);w!==-1&&x(w)}})},{root:null,rootMargin:"0px",threshold:.5});return o.current.forEach(n=>n&&s.observe(n)),()=>{o.current.forEach(n=>n&&s.unobserve(n))}},[i]),e.jsxs("footer",{className:"container mx-auto max-w-4xl md:rounded-md relative shadow-xl",children:[e.jsx(A,{isOpen:t,onDidDismiss:j,initialBreakpoint:1,breakpoints:[0,1],children:e.jsx(J,{handleClose:j})}),e.jsxs(b,{className:"ion-no-padding flex-grow bg-transparent relative",children:[e.jsx(h,{className:"ion-no-padding gap-2 bg-none flex overflow-x-auto snap-x snap-mandatory scroll-smooth no-scrollbar overscroll-none no-scroll rounded-t-md",children:i.length>0&&(c==null?void 0:c.accountType)==="User"?i.map((s,n)=>e.jsxs("div",{ref:u=>o.current[n]=u,className:"flex-none w-full h-full flex justify-center items-center snap-center bg-white ion-padding",children:[e.jsxs("div",{className:"flex flex-col text-center items-center justify-center w-full h-full p-2",children:[s.businessLogo&&e.jsx("img",{className:"w-20",src:s.businessLogo,alt:"Business Logo"}),e.jsx("span",{children:s.street}),e.jsxs("span",{children:[s.city,", ",s.state]})]}),e.jsxs("div",{className:"flex w-full h-full pt-1 mx-auto items-center justify-center",children:[e.jsx("div",{onClick:()=>r>0&&m(r-1),className:`cursor-pointer ${r===0?"text-slate-300":"text-white"}`,children:e.jsx(I,{icon:he,size:"small"})}),i.map((u,w)=>e.jsx("div",{onClick:()=>m(w),className:`w-1 h-1 mx-1 rounded-full cursor-pointer ${w===r?"bg-white":"bg-slate-300"}`},w)),e.jsx("div",{onClick:()=>r<i.length-1&&m(r+1),className:`cursor-pointer ${r===i.length-1?"text-slate-300":"text-white"}`,children:e.jsx(I,{icon:xe,size:"small"})})]})]},n)):e.jsx("div",{children:"No locations found"})}),e.jsx("span",{className:"p-2 absolute rounded-tr-md h-full flex flex-col items-center justify-center top-0 right-0 bg-orange",children:e.jsxs("div",{size:"2",className:"flex flex-col items-end justify-end",children:[e.jsx("div",{className:"flex flex-col text-xs items-center justify-center font-bold",children:e.jsx(g,{shape:"round",color:"secondary",size:"small",onClick:"",children:e.jsx(I,{slot:"icon-only",icon:me})})}),e.jsx("div",{className:"flex flex-col text-xs items-center justify-center font-bold",children:e.jsx(g,{size:"small",shape:"round",color:"secondary",onClick:d,children:e.jsx(I,{slot:"icon-only",icon:Z})})})]})})]}),i.length>0&&(c==null?void 0:c.accountType)==="User"&&e.jsx(b,{className:"ion-justify-content-center",children:e.jsx(h,{size:"auto",color:"primary",className:"mx-auto ion-text-center ion-align-items-center text-black"})})]})}function Se({totalWeight:t=0}){const o={energy:100,miles:200,cubicFeet:50},[i,c]=f.useState(o),d=t*.4||0,j=t*.8||0,m=t*.5||0;f.useEffect(()=>{d>=i.energy&&c(n=>({...n,energy:n.energy+100})),j>=i.miles&&c(n=>({...n,miles:n.miles+200})),m>=i.cubicFeet&&c(n=>({...n,cubicFeet:n.cubicFeet+50}))},[d,j,m,i]);const s=[{label:"Days of Home Power",value:d,threshold:i.energy,color:"bg-orange"},{label:"Miles Driven",value:j,threshold:i.miles,color:"bg-blue-500"},{label:"Cubic Feet Saved",value:m,threshold:i.cubicFeet,color:"bg-yellow-500"}];return e.jsx(M,{className:"p-4",children:e.jsx("div",{className:"space-y-6",children:s.map((n,u)=>e.jsxs(b,{className:"items-center",children:[e.jsx(h,{size:"3",children:e.jsx(P,{className:"text-sm font-medium text-gray-700",children:n.label})}),e.jsxs(h,{size:"9",children:[e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-4",children:e.jsx(D.div,{className:`h-4 rounded-full ${n.color}`,initial:{width:0},animate:{width:`${Math.min(n.value/(n.threshold||1)*100,100)}%`},transition:{duration:1.5,ease:"easeOut"}})}),e.jsxs(P,{className:"text-xs text-gray-600 mt-1 block",children:[n.value.toFixed(1)," / ",n.threshold," ",n.label.split(" ")[0].toLowerCase()]})]})]},u))})})}function Le(){return e.jsxs(q,{className:"max-w-4xl mx-auto shadow-lg rounded-lg",children:[e.jsxs(Y,{className:"bg-slate-100 rounded-t-lg pb-2",children:[e.jsx(K,{className:"flex w-full justify-between items-center",children:e.jsxs(b,{className:"flex justify-between w-full",children:[e.jsx(h,{size:"auto",className:"rounded-full text-center bg-grean px-4 flex items-center justify-center",children:e.jsx("div",{className:"text-white rounded-full text-lg font-semibold text-center",children:"Impact"})}),e.jsx(h,{size:"auto",className:"pr-2",children:e.jsxs("div",{className:"flex items-center justify-end text-grean font-bolds text-lg gap-1",children:[e.jsx("span",{className:"",children:"Level:"}),e.jsx("span",{className:"font-bold",children:"0"})]})})]})}),e.jsx("div",{className:"absolute top-1 right-1",children:e.jsx(I,{size:"small",slot:"icon-only",className:"text-slate-400 cursor-pointer",icon:fe})})]}),e.jsx(M,{className:"px-4",children:e.jsx(Se,{})})]})}function Ee(){return e.jsx("div",{children:"MyPickups"})}const Be=({profile:t})=>{const[l,r]=f.useState(!1),x=(t==null?void 0:t.locations)??[];return t?e.jsxs(B,{className:"h-full overflow-auto flex flex-col justify-end ion-no-padding bg-gradient-to-t from-grean to-blue-300 sm:px-8",children:[e.jsx(A,{isOpen:l,onDidDismiss:()=>r(!1),children:e.jsx(J,{handleClose:()=>r(!1)})}),e.jsxs("main",{className:"container max-w-2xl mx-auto flex-grow overflow-auto ion-padding",children:[e.jsx(be,{profile:t}),e.jsx(ke,{}),e.jsx(Le,{})]}),(t==null?void 0:t.accountType)==="User"&&x.length?e.jsx(Te,{}):e.jsx(b,{className:"container max-w-2xl mx-auto w-full bg-white border-t-yellow-300 border-t rounded-t-md drop-shadow-xl",children:e.jsx(h,{size:"auto",className:"mx-auto ion-padding-horizontal py-2",children:e.jsxs(g,{fill:"outline",size:"small",color:"primary",expand:"block",onClick:()=>r(!0),className:"text-sm",children:["Add Location",e.jsx(I,{slot:"start",icon:Z})]})})}),(t==null?void 0:t.accountType)==="Driver"&&e.jsx(Ee,{})]}):e.jsx(B,{className:"h-full flex items-center justify-center",children:e.jsx(b,{children:e.jsx(h,{className:"text-center",children:e.jsx(g,{color:"primary",expand:"block",children:"Loading Profile..."})})})})};export{Be as default};
