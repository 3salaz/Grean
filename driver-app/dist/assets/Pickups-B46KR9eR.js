import{ad as L,M as Y,q as x,ae as _,af as y,t as e,T as H,U as k,N as f,O as r,G as m,P as M,ag as Z,D as T,ah as E,E as O,y as N,a2 as R,a3 as B,ai as J,L as W,aj as X,Y as ee,$ as se,Z as ae,ak as ie,u as te,aa as le,A as q,Q as ne,al as re}from"./index-DApr8FCz.js";import{m as F,a as ce}from"./pickups-Cp_RIW2L.js";const oe=({userLocations:d})=>{const{userOwnedPickups:h,createPickup:b}=L(),{currentLocation:a}=Y(),[u,o]=x.useState(!1);x.useRef(null);const[D,v]=_(),i=(s,l)=>{P(n=>({...n,[s]:l}))},[t,P]=x.useState({pickupTime:"",addressData:{address:""},materials:[],disclaimerAccepted:!1}),c=async()=>{await D({message:"Requesting pickup…",spinner:"crescent"});try{if(h.filter(n=>n.status==="pending"||n.status==="accepted").length>=2){W.error("You can only have 2 active pickups at a time.");return}if(!t.addressData.address||!t.pickupTime||t.materials.length===0){W.error("Complete all required fields.");return}await b(t)&&P({pickupTime:y().add(1,"day").hour(7).minute(0).second(0).toISOString(),addressData:{address:""},materials:[],disclaimerAccepted:!1})}catch{W.error("Failed to submit pickup.")}finally{await v()}},w=y().add(1,"day").hour(7).minute(0).second(0),[g,I]=x.useState(t.materials),[A,V]=x.useState(t.pickupTime),[G,$]=x.useState(!!t.pickupTime);[...(h??[]).filter(s=>y(s.pickupTime).isAfter(y()))].sort((s,l)=>y(l.pickupTime).valueOf()-y(s.pickupTime).valueOf());const K=t.materials.some(s=>{var l;return(l=F[s.type])==null?void 0:l.requiresAgreement});return x.useEffect(()=>{a&&!t.addressData.address&&i("addressData",{address:a.address})},[a]),e.jsx(H,{mode:"wait",children:e.jsxs(k.section,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},transition:{duration:.3},className:"flex-grow flex flex-col gap-6 overflow-auto rounded-md w-full",children:[e.jsxs(k.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.3},className:"w-full ion-padding-horizontal",children:[e.jsxs(f,{onClick:()=>o(!u),className:`bg-white rounded-2xl ion-padding-horizontal justify-between items-center cursor-pointer transition-all duration-200 border-white border hover:border-[#75B657] ${u?"rounded-b-none":""}`,children:[e.jsx(r,{size:"auto",children:e.jsx("div",{className:"text-xs py-2",children:"What material(s) are you recycling?"})}),e.jsx(r,{size:"auto",children:e.jsx(m,{size:"small",fill:"clear",onClick:s=>{s.stopPropagation(),o(!u)},children:e.jsx(M,{icon:Z})})})]}),u&&e.jsx(k.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.3},className:"w-full",children:e.jsx(f,{className:"rounded-b-lg ion-padding bg-white",children:e.jsxs(r,{size:"12",className:"rounded-md",children:[ce.map(s=>e.jsxs(T,{className:"text-xs",lines:"none",children:[e.jsx(E,{slot:"start",checked:g.some(l=>l.type===s),onIonChange:l=>{const z=l.detail.checked?[...g,{type:s,weight:0}]:g.filter(p=>p.type!==s);I(z)}}),e.jsx(O,{className:"bg-slate-[#75B657] p-1",children:s.charAt(0).toUpperCase()+s.slice(1).replace("-"," ")})]},s)),e.jsx(T,{className:"flex",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(m,{size:"small",color:"danger",onClick:()=>{i("materials",[]),o(!1)},children:"Clear"}),e.jsx(m,{size:"small",color:"primary",onClick:()=>{i("materials",g),o(!1)},children:"Confirm"})]})})]})})},"material-dropdown-inner")]},"material-card-container"),t.materials.length>0&&e.jsx(k.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.8},className:"w-full",children:e.jsxs(f,{className:"shadow-none bg-orange-50 rounded-xl shadow-lg",children:[e.jsxs(r,{size:"12",className:"ion-padding",children:[e.jsx("div",{className:"p-2 w-full",children:e.jsx(N,{className:"font-bold text-green-800 w-full text-center",children:"Pickup Details"})}),e.jsx("p",{className:"px-2 pb-1 text-xs",children:"Lets tell the driver what to expect"})]}),e.jsx(r,{size:"12",className:"ion-padding-vertical",children:t.materials.map((s,l)=>{const n=F[s.type],z=n.label;return e.jsxs("div",{className:"px-3 py-2 bg-white",children:[e.jsx(N,{className:"font-medium text-green-800",children:z}),n.min!==void 0&&e.jsxs(T,{lines:"none",children:[e.jsx(O,{position:"stacked",className:"text-xs",children:"Quantity / Weight"}),e.jsx("input",{type:"number",inputMode:"numeric",pattern:"[0-9]*",value:s.weight||"",min:n.min,max:n.max,onChange:p=>{const j=p.target.value;if(/^\d*$/.test(j)){const C=parseInt(j)||0;i("materials",t.materials.map((U,S)=>S===l?{...U,weight:C}:U))}},onKeyDown:p=>{(["e","E","+","-",".",","," "].includes(p.key)||p.ctrlKey&&["v","V"].includes(p.key))&&p.preventDefault()},className:"border rounded-md px-2 py-1 text-sm w-full"}),e.jsxs(N,{className:"text-[10px] text-gray-500",children:["Min ",n.min," • Max ",n.max]})]}),(s.type==="plastic"||s.type==="aluminum")&&e.jsxs(T,{lines:"none",children:[e.jsx(O,{position:"stacked",className:"text-xs",children:"Storage Method"}),e.jsxs(R,{value:s.storageMethod,placeholder:"Select Method",onIonChange:p=>{i("materials",t.materials.map((j,C)=>C===l?{...j,storageMethod:p.detail.value}:j))},children:[e.jsx(B,{value:"bag25",children:"25 lb Bag"}),e.jsx(B,{value:"bag50",children:"50 lb Bag"}),e.jsx(B,{value:"greanBin",children:"Grean Bin"})]})]}),n.requiresPhoto&&e.jsxs(T,{lines:"none",className:"flex flex-col",children:[e.jsx(O,{color:"danger",position:"stacked",className:"text-xs pb-8 text-red-500",children:"Upload Photo*"}),e.jsx("input",{className:"border-1 border-slate-150 drop-shadow-lg rounded-md text-center p-2 w-28 aspect-square cursor-pointer",type:"file",accept:"image/*",onChange:async p=>{var C;const j=(C=p.target.files)==null?void 0:C[0];if(j){const U=URL.createObjectURL(j);i("materials",t.materials.map((S,Q)=>Q===l?{...S,photos:[...S.photos||[],U]}:S))}}}),s.photos&&e.jsx("div",{className:"flex gap-2 mt-1",children:s.photos.map((p,j)=>e.jsx("img",{src:p,alt:"preview",className:"w-12 h-12 rounded object-cover"},j))})]}),!t.disclaimerAccepted&&n.requiresAgreement&&e.jsx("p",{className:"text-xs text-gray-600 mt-1 ion-padding-horizontal",children:n.agreementLabel})]},l)})}),K&&e.jsx(k.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},transition:{duration:.4},className:"w-full",children:e.jsxs("div",{className:"bg-slate-50 w-full border-t-[#75B657] border-t-2 rounded-b-xl flex items-center justify-center gap-2 ion-padding-horizontal",children:[e.jsx(E,{checked:t.disclaimerAccepted,onIonChange:s=>i("disclaimerAccepted",s.detail.checked),slot:"start"}),e.jsx(N,{className:"text-xs text-gray-800 ion-padding-vertical",children:"I have read and agree to the material handling policies."})]})},"disclaimer-checkbox")]})},"material-list"),t.disclaimerAccepted&&e.jsx(k.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},transition:{duration:.4},className:"w-full",children:e.jsxs(f,{className:"rounded-md bg-orange-50 ion-padding-vertical",children:[e.jsx(r,{size:"12",className:"ion-padding flex items-center justify-center",children:e.jsx(N,{className:"font-bold w-full",children:"Pickup Date & Time"})}),G?e.jsxs(e.Fragment,{children:[e.jsx(r,{size:"12",className:"ion-padding",children:e.jsx(N,{className:"text-lg font-medium rounded-md bg-white ion-padding",children:y(t.pickupTime).format("dddd, MMM D • h:mm A")})}),e.jsx(r,{className:"ion-padding",children:e.jsx(m,{size:"small",color:"light",fill:"solid",className:"w-auto",onClick:()=>$(!1),children:"Edit Pickup Time"})})]}):e.jsx(e.Fragment,{children:e.jsxs(r,{size:"12",className:"ion-padding-vertical",children:[e.jsx(J,{presentation:"date-time",value:A,className:"rounded-md w-full bg-white",onIonChange:s=>{var n;const l=(n=s.detail.value)==null?void 0:n.toString();l&&V(l)},min:w.toISOString(),minuteValues:"0,15,30,45"}),e.jsx("div",{className:"bg-white ion-padding",children:e.jsx(m,{size:"small",color:"light",onClick:()=>{i("pickupTime",A),$(!0)},children:"Confirm Pickup Time"})})]})})]})},"pickup-date"),t.pickupTime&&e.jsxs(k.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.3},className:"w-full",children:[e.jsx(f,{children:e.jsx(r,{size:"12",children:e.jsx(N,{className:"text-sm",children:"What location are we adding this pickup for?"})})}),e.jsx(f,{className:"w-full",children:e.jsx(r,{size:"auto",className:"font-bold w-full text-sm",children:e.jsx(R,{className:"border-2 border-dotted rounded-md px-2",value:t.addressData.address||"",placeholder:"Select Address for Pickup",onIonChange:s=>{const l=d.find(n=>n.address===s.detail.value);l&&i("addressData",{address:l.address})},children:d.map((s,l)=>{const n=s.address.split(","),z=n.length>=2?`${n[0]}, ${n[1]}`:s.address;return e.jsx(B,{value:s.address,children:z},l)})})})})]},"select-location"),t.pickupTime&&t.addressData.address&&t.disclaimerAccepted&&e.jsx(k.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},transition:{duration:.4},className:"w-full",children:e.jsx(f,{className:"gap-2 w-full ion-padding",children:e.jsx(r,{size:"auto",className:"mx-auto",children:e.jsx(m,{color:"primary",fill:"outline",size:"small",onClick:c,children:"Submit Pickup"})})})},"submit")]})})};function de(d){if(!d)return{dayOfWeek:"",monthName:"",day:"",year:""};const h=new Date(d);if(isNaN(h.getTime()))return{dayOfWeek:"Invalid Date",monthName:"",day:"",year:""};const a=new Intl.DateTimeFormat("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric"}).formatToParts(h).reduce((u,o)=>(o.type!=="literal"&&(u[o.type]=o.value),u),{});return{dayOfWeek:a.weekday,monthName:a.month,day:a.day,year:a.year}}function me({selectedDate:d,onDateChange:h}){const{userOwnedPickups:b}=L(),[a,u]=x.useState(y()),o=c=>Array.from({length:7}).map((w,g)=>c.startOf("week").add(g,"day")),[D,v]=x.useState(o(a));x.useEffect(()=>{v(o(a))},[a]);const i=()=>{const c=a.subtract(7,"day");u(c),h(c)},t=()=>{const c=a.add(7,"day");u(c),h(c)},P=c=>b.filter(w=>y(w.pickupTime).isSame(c,"day")).length;return e.jsxs("div",{className:"w-full drop-shadow-lg ion-padding-horizontal",children:[e.jsx(f,{className:"w-full",children:e.jsx(r,{size:"auto",children:e.jsx(N,{className:"text-xl font-bold",children:"Calendar"})})}),e.jsx(f,{className:"ion-justify-content-evenly ion-padding-vertical gap-1",children:D.map(c=>{const w=c.isSame(d,"day"),g=P(c);return e.jsxs(r,{size:"auto",className:`py-2 px-1 border-1 rounded-lg cursor-pointer text-center bg-yellow-50 text-xs drop-shadow-xl flex-wrap flex flex-col ${w?"border-inset border-slate-100":"border-yellow-50"}`,onClick:()=>h(c),children:[e.jsx("div",{className:"text-lg",children:c.format("D")}),e.jsx("div",{className:"text-xs",children:c.format("ddd")}),e.jsx("div",{className:"flex flex-wrap justify-center",children:Array.from({length:g}).map((I,A)=>e.jsx("span",{className:"bg-orange-500 w-2 h-2 rounded-full"},A))})]},c.format())})}),e.jsxs(f,{className:"ion-justify-content-between ion-padding",children:[e.jsx(r,{size:"auto",children:e.jsx(m,{color:"secondary",size:"small",onClick:i,children:"This Week"})}),e.jsx(r,{size:"auto",children:e.jsx(m,{size:"small",color:"light",children:e.jsx(M,{icon:X})})}),e.jsx(r,{size:"auto",children:e.jsx(m,{color:"secondary",size:"small",onClick:t,children:"Next Week"})})]})]})}function ue(){const{userOwnedPickups:d}=L(),[h,b]=x.useState({}),[a,u]=x.useState(y()),o=d.filter(i=>y(i.pickupTime).isSame(a,"day")),D=["pending","accepted","inProgress","completed"],v=o.reduce((i,t)=>(i[t.status]=i[t.status]||[],i[t.status].push(t),i),{});return D.forEach(i=>{v[i]||(v[i]=[])}),e.jsxs(k.section,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},transition:{duration:.3},className:"h-full w-full flex flex-col justify-end bg-[#75B657]/70 rounded-md drop-shadow-xl",children:[e.jsxs(ee,{className:"ion-padding",children:[e.jsx(se,{className:"font-bold",children:o.length===0?"No Pickups":`Pickups: (${o.length})`}),e.jsx(ae,{className:"text-white",children:"View or edit your pickups below"})]}),e.jsxs("main",{className:"flex-grow overflow-auto flex flex-col gap-2",children:[o.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center flex-grow bg-white py-12",children:[e.jsx("img",{src:ie,alt:"No pickups",className:"w-16 h-16"}),e.jsx(N,{className:"text-sm text-gray-500 font-bold",children:"No pickups to display"})]}):o.map(i=>{const{dayOfWeek:t,monthName:P,day:c,year:w}=de(i.pickupTime);return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg shadow-md p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg",children:`${t}, ${P} ${c}, ${w}`}),e.jsx("p",{className:"text-sm text-gray-500",children:i.addressData.address||"Unknown Address"})]}),e.jsx("span",{className:`px-2 py-1 text-xs rounded-full font-medium text-white ${i.status==="pending"?"bg-yellow-500":i.status==="accepted"?"bg-blue-500":i.status==="inProgress"?"bg-purple-500":"bg-green-600"}`,children:i.status})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 mb-3",children:i.materials.map((g,I)=>e.jsxs("div",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:g.type.charAt(0).toUpperCase()+g.type.slice(1)}),": ",g.weight," lbs"]},I))}),e.jsxs("p",{className:"text-xs text-gray-600 italic mb-3",children:["Pickup Notes: ",i.pickupNote||"None"]}),["pending","accepted"].includes(i.status)&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(m,{expand:"block",color:"primary",size:"small",children:"Edit Pickup"}),e.jsx(m,{expand:"block",color:"danger",size:"small",children:"Delete Pickup"})]})]},i.id)}),e.jsx(me,{selectedDate:a,onDateChange:u})]})]})}const fe=()=>{const[d,h]=x.useState("UserPickupForm"),{fetchUserOwnedPickups:b}=L(),{profile:a}=te(),u=Array.isArray(a==null?void 0:a.locations)?a.locations:[],{locations:o}=le(u);return x.useEffect(()=>{a!=null&&a.uid&&b(a.uid)},[a==null?void 0:a.uid]),a?e.jsxs(q,{className:"container h-full max-w-2xl mx-auto flex flex-col drop-shadow-xl md:py-4 md:rounded-md",children:[e.jsx("header",{className:"ion-padding-horizontal",children:e.jsxs(f,{id:"pickups-header",className:"border-b border-slate-200 w-full flex justify-between items-center ion-padding shadow-none",children:[e.jsxs(r,{size:"auto",className:"flex flex-col items-center",children:[e.jsx(N,{className:"text-md text-[#75B657] border-[#75B657] border-1 font-bold bg-white px-4 py-1 rounded-2xl",children:a.displayName}),e.jsx("div",{className:"text-sm px-2 font-semibold pt-2",children:a.accountType})]}),e.jsx(r,{size:"auto",className:"flex",children:e.jsx(m,{color:"light",shape:"round",size:"small",children:e.jsx(M,{color:"primary",slot:"icon-only",icon:ne})})})]})}),e.jsx("main",{id:"pickups-mainView",className:"ion-padding flex flex-col flex-grow overflow-y-auto w-full",children:d==="UsersScheduleCard"?e.jsx(ue,{}):e.jsx(oe,{userLocations:o})}),e.jsx("footer",{id:"pickups-footer",children:e.jsxs(f,{className:"gap-4 justify-center ion-padding",children:[e.jsxs(r,{size:"auto",className:"text-center",children:[e.jsx(m,{className:"pb-1",fill:d==="UserPickupForm"?"solid":"clear",onClick:()=>h("UserPickupForm"),children:"Request Pickups"}),d==="UserPickupForm"&&e.jsx("div",{className:"w-full h-1 bg-[#75B657] rounded-full"})]}),e.jsxs(r,{size:"auto",className:"text-center",children:[e.jsx(m,{className:"pb-1",fill:d==="UsersScheduleCard"?"solid":"clear",onClick:()=>h("UsersScheduleCard"),children:e.jsx(M,{icon:re})}),d==="UsersScheduleCard"&&e.jsx("div",{className:"w-full h-1 bg-[#75B657] rounded-full"})]})]})})]}):e.jsx(q,{className:"h-full flex items-center justify-center",children:e.jsx(f,{children:e.jsx(r,{className:"text-center",children:e.jsx(m,{color:"primary",expand:"block",children:"Loading Profile..."})})})})};export{fe as default};
